#! /bin/sh

DEFAULT_DIST="altlinux"

if [ ! -d /sys/firmware/efi ]; then
	echo "Not booted in EFI mode, unable to update EFI GRUB"
	exit 0
fi

GRUB_SYSCONF=/etc/sysconfig/grub2

if [ ! -f "$GRUB_SYSCONF" ]; then
    echo "There is no $GRUB_SYSCONF, nothing to do"
    exit 0
fi

. "$GRUB_SYSCONF"

DIST="${GRUB_BOOTLOADER_DIST:-$DEFAULT_DIST}"
EFI_DIR="/boot/efi"
GRUB_EFI="$EFI_DIR/EFI/$DIST/@GRUB_EFI_NAME@"
GRUB_CFG="$EFI_DIR/EFI/$DIST/grub.cfg"

if [ ! -f "$GRUB_EFI" ]; then
	echo "$GRUB_EFI missing, nothing to update"
	exit 0
fi

case "$GRUB_AUTOUPDATE_FORCE" in
	true|yes) GRUB_FORCE="--force";;
esac

echo "Updating grub in $EFI_DIR"
grub-install $GRUB_FORCE
